<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Prof. Adriano Barbosa - blog</title><link href="http://barbosaaob.github.io/" rel="alternate"></link><link href="http://barbosaaob.github.io/feeds/blog.atom.xml" rel="self"></link><id>http://barbosaaob.github.io/</id><updated>2018-05-31T23:37:29-04:00</updated><entry><title>encrypt partition in OpenBSD</title><link href="http://barbosaaob.github.io/blog/encrypt-partition-openbsd.html" rel="alternate"></link><published>2018-05-31T23:37:29-04:00</published><updated>2018-05-31T23:37:29-04:00</updated><author><name>Adriano Barbosa</name></author><id>tag:barbosaaob.github.io,2018-05-31:/blog/encrypt-partition-openbsd.html</id><summary type="html">&lt;p&gt;This post is meant to guide througt encrypt a specific partition in OpenBSD. We will encrypt /home partition:&lt;/p&gt;
&lt;p&gt;Umount /home partition&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# umount /home
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Discover the name of /home partition&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# disklabel -E sdX
Label editor (enter &amp;#39;?&amp;#39; for help at ane prompt)
&amp;gt; p g
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;in my disk the /home patition is &lt;code&gt;m â€¦&lt;/code&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;This post is meant to guide througt encrypt a specific partition in OpenBSD. We will encrypt /home partition:&lt;/p&gt;
&lt;p&gt;Umount /home partition&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# umount /home
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Discover the name of /home partition&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# disklabel -E sdX
Label editor (enter &amp;#39;?&amp;#39; for help at ane prompt)
&amp;gt; p g
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;in my disk the /home patition is &lt;code&gt;m:&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Change /home file system type&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt; m m
offset: [...]
size: [...]
FS type: [4.2BSD] RAID
&amp;gt; w
&amp;gt; q
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Write random data to avoid data recovery and protect the encrypted data&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# dd if=/dev/random of=/dev/rsdXm bs=1m
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now we attach &lt;code&gt;sdXm&lt;/code&gt; as an crypto volume&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# bioctl -c C -l /dev/sdXm softraid0
New passphrase:
Re-type passphrase:
softraid0: CRYPTO volume attached as sdY
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Note that our crypto volume is no identifies as &lt;code&gt;sdY&lt;/code&gt; from now on.&lt;/p&gt;
&lt;p&gt;Let's now zero the first megabyte of &lt;code&gt;sdY&lt;/code&gt; to ...&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# dd if=/dev/zero of=/dev/rsdYc bs=1m count=1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now we create a partition on &lt;code&gt;sdY&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# fdisk -iy sdY
# disklabel -E sdY
Label editor (enter &amp;#39;?&amp;#39; for help at ane prompt)
&amp;gt; a
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Format the partition&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# newfs /dev/rsdYa
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Delete or comment /home entry in /etc/fstab.&lt;/p&gt;
&lt;p&gt;Get the disk uid&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# disklabel sdX | grep uid
duid: 123abc
# disklabel sdY | grep uid
duid: 789xyz
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;We need to mount the crypto volume at boot. Add the following lines to start up script /etc/rc.local&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;for i in 1 2 3; do  # tries to mount 3 times
    bioctl -c C -l 123abc.m softraid0 &amp;amp;&amp;amp; break  # attach sdXm as crypto volume
    sleep 2  # wait 2 seconds between tries
done
fsck /dev/rsdYa  # check crypto volume fs for error
mount -o rw,nodev,nosuid,softdep 789xyz.a /home  # mount partition
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And we are done! Your system is ready to boot with the /home partition enctypted and ready to mount at boot.&lt;/p&gt;
&lt;p&gt;Last note: /home partition is completelly empty, so if you have any user other than root on your system, you need to create each user directory and set the right permitions.&lt;/p&gt;</content><category term="comp"></category></entry><entry><title>teste math</title><link href="http://barbosaaob.github.io/blog/teste2.html" rel="alternate"></link><published>2018-05-29T09:32:46-04:00</published><updated>2018-05-29T09:32:46-04:00</updated><author><name>Adriano Barbosa</name></author><id>tag:barbosaaob.github.io,2018-05-29:/blog/teste2.html</id><summary type="html">&lt;h1&gt;teste math&lt;/h1&gt;
&lt;p&gt;lalalalala&lt;/p&gt;</summary><content type="html">&lt;h1&gt;teste math&lt;/h1&gt;
&lt;p&gt;lalalalala&lt;/p&gt;</content><category term="math"></category></entry><entry><title>teste</title><link href="http://barbosaaob.github.io/blog/teste.html" rel="alternate"></link><published>2018-05-29T09:32:10-04:00</published><updated>2018-05-29T09:32:10-04:00</updated><author><name>Adriano Barbosa</name></author><id>tag:barbosaaob.github.io,2018-05-29:/blog/teste.html</id><summary type="html">&lt;h1&gt;teste&lt;/h1&gt;
&lt;p&gt;lalalalala&lt;/p&gt;</summary><content type="html">&lt;h1&gt;teste&lt;/h1&gt;
&lt;p&gt;lalalalala&lt;/p&gt;</content><category term="comp"></category></entry></feed>